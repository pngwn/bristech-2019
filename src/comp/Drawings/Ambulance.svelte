<script>
	import { tweened } from "svelte/motion";
	import { ambulance } from "./drawings.js";

	export let color = "yellow";
	export let opacity = 1;
	export let coords;

	$: console.log(coords);

	function draw(path, opts = {}) {
		const length = path.getTotalLength();
		path.style.strokeDasharray = length;
		const dash = tweened(length, opts);
		const u = dash.subscribe(v => (path.style.strokeDashoffset = v));
		dash.set(0);

		return {
			destroy: u,
		};
	}

	let delay = 0;
	let ambulance_meta = [];

	for (let p = 0; p < ambulance.length; p++) {
		if (p === 0) {
			ambulance_meta.push({
				...ambulance[p],
				delay: 0,
			});
		} else {
			ambulance_meta.push({
				...ambulance[p],
				delay:
					ambulance_meta[ambulance_meta.length - 1].delay +
					ambulance_meta[ambulance_meta.length - 1].duration,
			});
		}
	}
</script>

<svg
	class="ambulance"
	width="100%"
	height="100%"
	viewBox="0 0 1958 1657"
	version="1.1"
	xmlns="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xml:space="preserve"
	style="opacity: {opacity}; transform: translate({coords.x * 0.75 - 50}px, {coords.y * 1.5 - 1620}px);
	fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">

	<defs>
		<filter
			id="chalk"
			height="2"
			width="1.6"
			color-interpolation-filters="sRGB"
			y="-0.5"
			x="-0.3">
			<feTurbulence
				baseFrequency="150"
				seed="115"
				result="result1"
				numOctaves="1"
				type="turbulence" />
			<feOffset result="result2" dx="-5" dy="-5" />
			<feDisplacementMap
				scale="12"
				yChannelSelector="G"
				in2="result1"
				xChannelSelector="R"
				in="SourceGraphic" />
			<feGaussianBlur stdDeviation="0.6" />
		</filter>
	</defs>

	{#each ambulance_meta as { d, delay, duration, style }}
		<path
			filter="url(#chalk)"
			use:draw={{ delay, duration }}
			style="stroke: {color};{style}"
			{d} />
	{/each}

	<circle radius="5" />

	<g>
		<path
			d="M8.158,989.858C7.912,991.757 11.114,987.366
			12.826,986.509C16.613,984.616 19.777,981.003 23.379,978.302C37.425,967.767
			51.572,955.598 66.763,945.471C108.316,917.769 148.578,892.331
			192.223,868.084C304.919,805.475 487.706,784.5
			613.161,802.422C743.546,821.049 795.616,899.467
			895.74,959.541C955.186,995.209 1017.97,1025.31
			1083.35,1049.83C1128.45,1066.74 1180.29,1066.2
			1227.57,1070.93C1412,1089.38 1589.3,1023.07 1758.72,959.541C1821.2,936.112
			1882.49,895.13 1939.29,861.049C1973.4,840.586 2011.2,838.643
			2045.99,827.046C2048.57,826.187 2056.54,824.449 2056.54,821.183"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M16.361,1331.68C15.841,1318.32 111.377,1253.11
			127.734,1243.29C260.178,1163.83 358.837,1142.44
			506.461,1121.35C530.287,1117.95 551.559,1125.3
			573.295,1130.73C626.739,1144.09 734.064,1177.77
			773.797,1217.5C794.389,1238.09 819.526,1256.19
			844.149,1272.61C861.16,1283.95 883.771,1290.31
			899.258,1301.92C924.955,1321.19 951.333,1339.26
			978.99,1355.86C1050.32,1398.65 1185.37,1387.05
			1269.78,1403.93C1376.92,1425.36 1745.9,1287.28
			1841.97,1233.91C1911.94,1195.04 1971.21,1154.53
			2050.68,1141.28C2063.92,1139.08 2074.11,1130.73 2088.2,1130.73"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M14.284,1177.57C16.444,1184.45 26.281,1169.56
			32.049,1165.24C46.416,1154.46 61.293,1142.94 76.605,1133.58C104.384,1116.6
			183.305,1077.31 183.305,1074.95"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M353.33,1003.97C353.028,1004.05 355.883,1002.31
			357.55,1001.75C372.562,996.748 388.947,992.989
			404.451,988.854C429.392,982.203 500.673,964.269 524.049,975.957"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M660.477,1006.63C659.102,1006.01 662.331,1006.44
			662.407,1006.44C683.214,1006.44 702.002,1015.2
			722.206,1020.51C744.421,1026.36 880.497,1075.98 880.497,1094.38"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M979.886,1163.42C982.029,1164.49 978.727,1168.68
			980.162,1170.6C983.604,1175.18 991.881,1180.6
			996.578,1183.49C1043.95,1212.64 1099.93,1230.93 1151.35,1251.5"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M1294.68,1255.61C1293.51,1258.05 1299.94,1254.29
			1302.61,1253.85C1315.21,1251.75 1327.29,1251.13
			1340.13,1250.33C1370.52,1248.43 1400.8,1243.23
			1430.41,1236.26C1443.68,1233.14 1464.03,1221.41 1463.24,1222.19"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M1644.85,1160.92C1644.87,1160.96 1654.81,1157.61
			1656.71,1156.53C1670.16,1148.84 1684.9,1143.19
			1698.92,1136.59C1716.48,1128.33 1778.65,1105.55 1778.65,1079.14"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
		<path
			d="M1970.46,1012.21C1973.02,1012.7 1974.72,1009.18
			1976.81,1007.62C2005.44,986.142 2032.38,972.206 2068.27,964.231"
			style="fill:none;stroke:black;stroke-width:6.5px;" />
	</g>
	<g>
		<path
			d="M-45.3,1013.97C-45.225,1014.11 -44.809,1012.76
			-44.409,1011.88C-43.481,1009.86 -42.647,1007.8
			-41.661,1005.81C-38.877,1000.19 -36.009,994.615
			-33.26,988.968C-25.173,972.35 -15.946,956.37 -7.738,939.797"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
		<path
			d="M-24.02,1000.62C-24.027,1000.63 -24.153,1000.45
			-24.171,1000.43C-24.572,999.854 -22.655,996.442
			-22.437,995.868C-21.326,992.923 -20.042,990.175
			-18.626,987.393C-13.511,977.339 -8.345,967.316
			-3.131,957.318C-1.423,954.041 0.432,950.848 2.152,947.581C2.562,946.803
			4.475,943.224 4.291,943.353"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
		<path
			d="M-2.828,986.227C-3.26,983.398 12.647,955.331 14.88,951.877"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
		<path
			d="M18.452,971.819C18.512,971.913 18.53,971.99
			18.628,971.883C21.048,969.257 22.351,964.646 23.999,961.471"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
		<path
			d="M-301.411,1093.74C-300.204,1094.25 -299.582,1092.07
			-298.572,1091.36C-277.835,1076.83 -258.268,1060.25
			-236.751,1046.85C-207.901,1028.89 -181.302,1007.92
			-153.527,988.446C-118.307,963.757 -82.019,940.092
			-48.304,913.447C-41.818,908.321 -30.893,907.422
			-27.556,905.083C-27.927,904.996 -30.124,903.233
			-30.05,903.125C-29.8,902.768 -27.914,903.602
			-27.607,903.699C-17.801,906.876 -7.597,913.258
			1.169,919.062C21.268,932.384 41.979,948.783 64.839,953.844C98.494,961.286
			137.216,951.804 167.906,973.49C184.143,984.963 189.816,999.858
			198.617,1016.98C201.488,1022.56 201.522,1028.4
			202.172,1034.32C202.217,1034.75 202.191,1036.96
			202.273,1036.97C200.061,1036.23 163.883,1066.75
			157.196,1071.44C155.167,1072.86 153.589,1067.39
			152.035,1065.18C148.726,1060.46 142.255,1055.14
			137.189,1052.72C117.681,1043.39 101.813,1037.98
			81.591,1044.72C43.933,1057.29 31.897,1107.83 56.373,1142.74C56.27,1141.9
			55.038,1144.64 53.922,1145.43C51.493,1147.13 49.031,1149.14
			46.802,1151.1C40.202,1156.89 33.089,1161.89 25.906,1166.92C4.205,1182.13
			-18.738,1196.36 -40.264,1211.45C-38.188,1197.98 -80.246,1180.73
			-91.231,1179.47C-142.562,1173.59 -174.738,1237.39
			-143.596,1281.81C-142.907,1280.93 -145.442,1283.05
			-146.352,1283.69C-148.112,1284.92 -149.722,1286.17
			-151.254,1287.68C-155.643,1292.01 -161.985,1294.65
			-167.042,1298.19C-166.572,1298.29 -170.429,1292.47
			-170.854,1291.99C-175.525,1286.73 -179.756,1280.75
			-183.825,1274.94C-187.138,1270.22 -185.918,1266.24
			-188.683,1261.23C-195.046,1249.69 -203.382,1239.27
			-210.336,1228.08C-232.185,1192.91 -257.604,1160.01
			-281.376,1126.1L-301.478,1097.42C-302.141,1096.48 -302.078,1094.27
			-303.149,1094.39"
			style="fill:none;stroke:black;stroke-width:3.29px;" />
		<path
			d="M-100.48,973.173C-100.956,972.094 -70.551,949.437
			-64.076,944.898C-28.206,919.752 -23.316,918.411
			16.425,943.592C23.071,947.803 38.922,952.579 42.973,959.652C44.551,962.412
			24.597,974.821 21.115,977.262C2.248,990.488 -17.213,1002.89
			-36.068,1016.11C-40.926,1019.52 -50.219,1031.42
			-57.002,1030.91C-58.275,1030.82 -59.055,1028.95
			-59.724,1028C-72.986,1009.08 -87.341,991.03 -100.574,972.153"
			style="fill:none;stroke:black;stroke-width:3.29px;" />
		<path
			d="M63.206,1138.84C61.073,1119.75 47.203,1095.55
			60.458,1075.94C91.192,1030.48 151.334,1058.22
			160.927,1110.39C162.863,1120.91 157.713,1129.07
			152.233,1136.75C145.81,1145.76 138.243,1156.41
			127.791,1160.69C106.715,1169.3 75.071,1158.17 63.426,1136.71"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
		<path
			d="M98.308,1137.46C98.472,1137.45 98.025,1137.8
			97.961,1137.84C93.591,1140.91 89.532,1133.5 86.841,1130.62C80.53,1123.87
			77.244,1113.31 77.374,1104.44C77.695,1082.81 98.192,1069.6
			118.06,1078.64C154.196,1095.09 130.758,1157.49 97.851,1139.46"
			style="fill:none;stroke:black;stroke-width:3.33px;" />
	</g>

</svg>

<style>
	svg {
		transition: 0.5s;
	}

	circle {
		cx: 24%;
		cy: 33%;
		r: 5;
		fill: red;
	}
</style>
